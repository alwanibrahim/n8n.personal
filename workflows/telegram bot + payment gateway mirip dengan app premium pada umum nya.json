{
  "active": false,
  "connections": {
    "Select rows from a table": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Select rows from a table1",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [],
        [],
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Send a text message6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert or update rows in a table": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Insert or update rows in a table",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message2": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Insert or update rows in a table1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert or update rows in a table1": {
      "main": [
        [
          {
            "node": "Send a text message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message6": {
      "main": [
        [
          {
            "node": "Insert rows in a table2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Insert rows in a table3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert rows in a table3": {
      "main": [
        [
          {
            "node": "Send a text message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table1": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Delete table or rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete table or rows": {
      "main": [
        [
          {
            "node": "Update rows in a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update rows in a table": {
      "main": [
        [
          {
            "node": "Select rows from a table2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table2": {
      "main": [
        [
          {
            "node": "Send a text message7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger1": {
      "main": [
        [
          {
            "node": "Select rows from a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert rows in a table2": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Select rows from a table6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Select rows from a table3",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Send a text message9",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [],
        [
          {
            "node": "Code8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Send a photo message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message8": {
      "main": [
        [
          {
            "node": "Send a text message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        []
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "Send a text message5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query": {
      "main": [
        []
      ]
    },
    "Select rows from a table3": {
      "main": [
        [
          {
            "node": "Code5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code5": {
      "main": [
        [
          {
            "node": "Select rows from a table4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table4": {
      "main": [
        [
          {
            "node": "Insert or update rows in a table2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert or update rows in a table2": {
      "main": [
        [
          {
            "node": "Select rows from a table5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table5": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table6": {
      "main": [
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a photo message1": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message5": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message9": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message10": {
      "main": [
        []
      ]
    },
    "Code7": {
      "main": [
        [
          {
            "node": "Send a text message10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code8": {
      "main": [
        [
          {
            "node": "Select rows from a table7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table7": {
      "main": [
        [
          {
            "node": "Send a text message11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message11": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-09-16T09:08:34.566Z",
  "id": "58EpDR0mTX5ea1LE",
  "isArchived": true,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "telegram bot + payment gateway mirip dengan app premium pada umum nya",
  "nodes": [
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "users",
          "mode": "list",
          "cachedResultName": "users"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "chat_id",
              "value": "={{ $json.message.chat.id }}{{ $json.callback_query.message.chat.id }}"
            }
          ]
        },
        "options": {
          "detailedOutput": true
        }
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        112,
        352
      ],
      "id": "116f6186-0c77-4170-b9aa-7c2d0e0db9f2",
      "name": "Select rows from a table",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data[0].status }}",
                    "rightValue": "IDLE",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "9b00dbce-1144-4437-bffa-f3ddc825fcf8"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "IDLE"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0c77a72b-f324-45de-9f59-8cc7ff00ed74",
                    "leftValue": "={{ $json.data[0].status }}",
                    "rightValue": "WAITING_EMAIL",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "WAITING_EMAIL"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e9d7626e-3696-400b-ba3d-1e80694a8f59",
                    "leftValue": "={{ $json.data[0].status }}",
                    "rightValue": "WAITING_OTP",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "WAITING_OTP"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7daff115-6f65-4a38-b4c7-fae51a827fb7",
                    "leftValue": "={{ $json.data[0].status }}",
                    "rightValue": "WAITING_PHONE",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "WAITING_PHONE"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2081e90e-7a14-4b55-afb0-1a49d5387fb7",
                    "leftValue": "={{ $json.data[0].status }}",
                    "rightValue": "WAITING_ADDRESS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "WAITING_ADDRESS"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3a77b550-68de-456f-8ac1-a2374b4a7337",
                    "leftValue": "={{ $json.data[0].status }}",
                    "rightValue": "WAITING_APPROVAL",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "WAITING_APPROVAL"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "91338592-c06c-430f-8ad9-07c5fa765b82",
                    "leftValue": "={{ $json.data[0].status }}",
                    "rightValue": "VERIFIED",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "VERIFIED"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "66f16421-9c7f-4f10-b263-0417b17b8f00",
                    "leftValue": "={{ $json.data[0].status }}",
                    "rightValue": "BLOCKED",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "BLOCKED"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        336,
        240
      ],
      "id": "d48ab3d0-1578-470f-9af5-635a246820ec",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "upsert",
        "table": {
          "__rl": true,
          "value": "users",
          "mode": "list",
          "cachedResultName": "users"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "id",
        "valueToMatchOn": "={{ $('Select rows from a table').item.json.data[0].id }}",
        "valuesToSend": {
          "values": [
            {
              "column": "status",
              "value": "WAITING_OTP"
            },
            {
              "column": "email",
              "value": "={{ $('Telegram Trigger1').item.json.message.text }}"
            },
            {
              "column": "chat_id",
              "value": "={{ $('Telegram Trigger1').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2704,
        -880
      ],
      "id": "59f08882-525e-4cd4-a884-c8648cfed5f1",
      "name": "Insert or update rows in a table",
      "alwaysOutputData": false,
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const email = $('Telegram Trigger1').first().json.message.text;\nconst regex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\nreturn[{\n  email, valid:regex.test(email)\n}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2256,
        -800
      ],
      "id": "14056b65-b7f1-45ec-af6d-bc002db64295",
      "name": "Code"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Masukkan email yang benar dan sesuai :",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2704,
        -688
      ],
      "id": "4939995b-9b52-46f0-9f51-a34d25a733c9",
      "name": "Send a text message1",
      "webhookId": "f8c537a5-56ba-4385-b311-8cfbbe998c31",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0f58af84-5fb8-4758-8abe-b7dafdf81b90",
              "leftValue": "={{ $json.valid }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2480,
        -800
      ],
      "id": "b2d81cb8-b27c-4d3c-baa6-e936b0ff37d3",
      "name": "If1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Mantap data email sudah di tambahkan, untuk melanjutkan saya telah mengirimkan otp kepada anda dengan tujuan keamanan account silahkan verifikasi terlebih dahulu,\nkirim otp anda ke sini :",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "EXIT",
                    "additionalFields": {
                      "callback_data": "EXIT"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3376,
        -880
      ],
      "id": "a65a2be2-ad10-4158-b832-25e336ed276b",
      "name": "Send a text message2",
      "webhookId": "09d5303a-37bb-4abc-94f9-581225f263e3",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.callback_query.data }}",
                    "rightValue": "EXIT",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "88db4e48-2632-4924-a754-66902b11a3ca"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "EXIT"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "140ee416-811d-4b42-a9c2-06670c4fa2c0",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.callback_query.data }}",
                    "rightValue": "REGISTER",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "REGISTER"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "152fbc8d-3050-4eda-a64e-a1d0f6c0d961",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.callback_query.data }}",
                    "rightValue": "PROFILE_USER",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "PROFILE_USER"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1216,
        -1200
      ],
      "id": "ac0aea99-3727-4bd4-ba0d-31fd43fbda08",
      "name": "Switch1"
    },
    {
      "parameters": {
        "operation": "upsert",
        "table": {
          "__rl": true,
          "value": "users",
          "mode": "list",
          "cachedResultName": "users"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "id",
        "valueToMatchOn": "={{ $json.data[0].id }}",
        "valuesToSend": {
          "values": [
            {
              "column": "chat_id",
              "value": "={{ $json.data[0].chat_id }}"
            },
            {
              "column": "status",
              "value": "IDLE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        1440,
        -1168
      ],
      "id": "8dd946aa-7202-46cd-bc17-cea4de5555c4",
      "name": "Insert or update rows in a table1",
      "alwaysOutputData": false,
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.callback_query.message.chat.id }}",
        "text": "Selamat datang di Toko mamam mewing :\n\nkami menyediakan banyak layanan terutama di dalam hal pembuatan web dan bot,\nsilahkan register terlebih dahulu jika belum memiliki account di telegram bot kita,\n\nthx youðŸ˜Š",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "REGISTER",
                    "additionalFields": {
                      "callback_data": "REGISTER"
                    }
                  },
                  {
                    "text": "PROFILE_USER",
                    "additionalFields": {
                      "callback_data": "PROFILE_USER"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1664,
        -1168
      ],
      "id": "4e214af1-43a6-49d5-a916-97f29ed38cd1",
      "name": "Send a text message3",
      "webhookId": "ddd3f713-6498-44f5-875f-daf58db87c33",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Selamat datang di Toko kami,\n\ntoko kami menyediakan banyak hal, diantarnya :\n1. app premium\n2. jasa web\n3. jasa bot\n4. jasa jasa lain nya\n\nSilahkan register terlebih dahulu dengan memasukkan email anda :",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2544,
        1120
      ],
      "id": "87ff2855-7a35-489a-8851-938dc3263d81",
      "name": "Send a text message6",
      "webhookId": "9524021e-8956-4ecb-8b41-6f2ed2d7de76",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "users",
          "mode": "list",
          "cachedResultName": "users"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "chat_id",
              "value": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            },
            {
              "column": "username",
              "value": "={{ $('Telegram Trigger1').item.json.message.chat.username }}"
            },
            {
              "column": "status",
              "value": "WAITING_EMAIL"
            },
            {
              "column": "is_verified",
              "value": "0"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2768,
        1120
      ],
      "id": "1d925dff-ca30-414a-97d4-6c6ea80eb06d",
      "name": "Insert rows in a table2",
      "alwaysOutputData": false,
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const now = new Date($now);\nconst otp = Math.floor(100000 + Math.random() * 900000).toString();\nconst expiredAt = new Date(now.getTime() + 5 * 60 * 1000);\n\n// Adjust untuk timezone WIB (UTC+7)\nfunction toLocalMySQLDateTime(date) {\n  const localDate = new Date(date.getTime() + (7 * 60 * 60 * 1000));\n  return localDate.toISOString().slice(0, 19).replace('T', ' ');\n}\n\nreturn [\n  {\n    json: {\n      otp_code: otp,\n      expired_at: toLocalMySQLDateTime(expiredAt),\n      created_at: toLocalMySQLDateTime(now)\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2928,
        -880
      ],
      "id": "4524107d-7de2-441f-bf72-57dbb909fd6b",
      "name": "Code1"
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "user_otps",
          "mode": "list",
          "cachedResultName": "user_otps"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "otp_code",
              "value": "={{ $json.otp_code }}"
            },
            {
              "column": "expired_at",
              "value": "={{ $json.expired_at }}"
            },
            {
              "column": "created_at",
              "value": "={{ $json.created_at }}"
            },
            {
              "column": "user_id",
              "value": "={{ $('Select rows from a table').item.json.data[0].id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        3152,
        -880
      ],
      "id": "d81b862a-5c63-4014-b65f-019dc4b0308b",
      "name": "Insert rows in a table3",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('If1').item.json.email }}",
        "subject": "otp verifikasi ",
        "message": "={{ $('Code1').item.json.otp_code }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        3600,
        -880
      ],
      "id": "46c051c8-a253-449c-8f4f-446a4eabd64f",
      "name": "Send a message",
      "webhookId": "3798745d-a310-4f4a-97b9-fdbaadb10406",
      "credentials": {
        "gmailOAuth2": {
          "id": "A0kR6KDbZM4fYEND",
          "name": "MamamMewing"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "user_otps",
          "mode": "list",
          "cachedResultName": "user_otps"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "user_id",
              "value": "={{ $json.data[0].id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2288,
        -416
      ],
      "id": "50138842-b1e5-42c9-89a8-140c8eef2185",
      "name": "Select rows from a table1",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Ambil waktu sekarang\nconst now = new Date();\n\n// Bandingkan dengan expired_at dari database\nif ($('Telegram Trigger1').first().json.message.text === $input.first().json.otp_code && \n    now < new Date($input.first().json.expired_at)) {\n  // OTP valid\n  return [{ json: { status: 'success', message: 'OTP valid' } }];\n} else {\n  // OTP salah atau expired\n  return [{ json: { status: 'error', message: 'OTP invalid atau expired' } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2448,
        -416
      ],
      "id": "f7fe43e1-75e3-4bbe-8c2c-403563de172e",
      "name": "Code2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b77d23a8-66b2-4a7c-83c7-67d408ecabc9",
              "leftValue": "={{ $json.status }}",
              "rightValue": "success",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2672,
        -416
      ],
      "id": "eb0dfc2c-055c-4c76-a7d5-34fddbb2c9c2",
      "name": "If2"
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "table": {
          "__rl": true,
          "value": "user_otps",
          "mode": "list",
          "cachedResultName": "user_otps"
        },
        "deleteCommand": "delete",
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $('Select rows from a table1').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2896,
        -416
      ],
      "id": "0bbd56a2-32da-44fa-90c4-c14b5ec8cbd2",
      "name": "Delete table or rows",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "users",
          "mode": "list",
          "cachedResultName": "users"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "id",
        "valueToMatchOn": "={{ $('Select rows from a table').item.json.data[0].id }}",
        "valuesToSend": {
          "values": [
            {
              "column": "status",
              "value": "VERIFIED"
            },
            {
              "column": "is_verified",
              "value": "1"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        3120,
        -416
      ],
      "id": "bafa9124-24f2-4cdb-be3c-7415c13f9a80",
      "name": "Update rows in a table",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Mantap kamu telah lolos verifikasi, profle mu sekarang :\nname : {{ $json.username }}\nemail : {{ $json.email }}\nstatus : {{ $json.is_verified === 1 ? 'âœ… Terverifikasi' : 'âŒ Belum Terverifikasi' }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3568,
        -416
      ],
      "id": "aa18a56d-a33b-471e-8a82-63690d477052",
      "name": "Send a text message7",
      "webhookId": "e972f352-37af-4d01-9209-4a02d2cf0cfc",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "users",
          "mode": "list",
          "cachedResultName": "users"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $('Select rows from a table').item.json.data[0].id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        3344,
        -416
      ],
      "id": "7c958423-0f0a-42c5-ad9d-ada6b25aca77",
      "name": "Select rows from a table2",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "*"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -112,
        352
      ],
      "id": "299a329c-254a-4b01-a7cf-6a716c7fb016",
      "name": "Telegram Trigger1",
      "webhookId": "b30c88f9-f56d-48dd-b6f9-da9ac04664ec",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": ".",
        "replyMarkup": "replyKeyboard",
        "replyKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "List product",
                    "additionalFields": {}
                  },
                  {
                    "text": "Stock",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "1",
                    "additionalFields": {}
                  },
                  {
                    "text": "2",
                    "additionalFields": {}
                  },
                  {
                    "text": "3",
                    "additionalFields": {}
                  },
                  {
                    "text": "4",
                    "additionalFields": {}
                  },
                  {
                    "text": "5",
                    "additionalFields": {}
                  },
                  {
                    "text": "6",
                    "additionalFields": {}
                  },
                  {
                    "text": "7",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "8",
                    "additionalFields": {}
                  },
                  {
                    "text": "9",
                    "additionalFields": {}
                  },
                  {
                    "text": "10",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Informasi",
                    "additionalFields": {}
                  },
                  {
                    "text": "Cara order",
                    "additionalFields": {}
                  },
                  {
                    "text": "Deposit",
                    "additionalFields": {}
                  }
                ]
              }
            }
          ]
        },
        "replyKeyboardOptions": {},
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        528,
        1344
      ],
      "id": "a1419c55-62a8-44a4-968f-9e67e0de77a7",
      "name": "Send a text message",
      "webhookId": "d7b9dca8-5fcf-4c1e-83e6-5dfe30ace08d",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "47f862c7-609f-4ac0-9b7a-54f432da489e",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text === 'List product' ?'/list_product': $('Telegram Trigger1').item.json.message.text}}",
                    "rightValue": "/list_product",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "/list_product"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6a5c771a-d552-4fa2-979e-7eef290731d7",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text === 'Stock'?'/stock': $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "/stock",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "/stock"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ad8a53c1-cfff-4057-b01b-c3e7ad1b77f2",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "/cara_order",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "/cara_order"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "94e560c0-c8df-42f7-b283-4559dd33d594",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text === 'Informasi' ? '/informasi': $('Telegram Trigger1').item.json.message.text }}\n",
                    "rightValue": "/informasi",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "/informasi"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a20d9cf9-52ca-4f68-a470-c509eef4f4d9",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "/deposit",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "/deposit"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "28e2c46d-00bf-4666-b604-c89c055c9d97",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "/start",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "/start"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d9fc99b5-4c4c-4f8c-a068-aca98610ecf7",
                    "leftValue": "={{ \n  $('Telegram Trigger1').item.json.message.text === '1' ? '1' :\n  $('Telegram Trigger1').item.json.message.text === '2' ? '2' :\n  $('Telegram Trigger1').item.json.message.text === '3' ? '3' :\n  $('Telegram Trigger1').item.json.message.text === '4' ? '4' :\n  $('Telegram Trigger1').item.json.message.text === '5' ? '5' :\n  $('Telegram Trigger1').item.json.message.text === '6' ? '6' :\n  $('Telegram Trigger1').item.json.message.text === '7' ? '7' :\n  $('Telegram Trigger1').item.json.message.text === '8' ? '8' :\n  $('Telegram Trigger1').item.json.message.text === '9' ? '9' :\n  $('Telegram Trigger1').item.json.message.text === '10' ? '10' :\n  null\n}}",
                    "rightValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "nomor"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1104,
        304
      ],
      "id": "a754bdeb-751f-43af-b554-ba5857f122af",
      "name": "Switch2"
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "binaryData": true,
        "additionalFields": {
          "caption": "=â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\nâ”Š   LIST KATEGORI\nâ”Š   Page 1/1\nâ”Šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâ”Š 1 CAPCUT\nâ”Š 2 CHAT GPT\nâ”Š 3 SPOTIFY 1B\nâ”Š 4 ALIGHT MOTION\nâ”Š 5 CANVA\nâ”Š 6 YOUTUBE\nâ”Š 7 GEMINI\nâ”Š 8 LOKLOK\nâ”Š 9 PRIME \nâ”Š 10 VIU ANLIM\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        528,
        -496
      ],
      "id": "d3147920-dabe-486a-a37b-c1b256c13f07",
      "name": "Send a photo message",
      "webhookId": "628f5e19-e831-44f5-bbdb-32a547e813c2",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "195xzT2TZm4y8MfKj88hMalRHDz91kv25",
          "mode": "list",
          "cachedResultName": "app_premium.png",
          "cachedResultUrl": "https://drive.google.com/file/d/195xzT2TZm4y8MfKj88hMalRHDz91kv25/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2768,
        -64
      ],
      "id": "c1a942ac-0b57-4e70-bfee-06143ed45360",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "uwKWWiaSURBtcVFx",
          "name": "alwanibrahim142"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Selamat datang di Toko kami,\n\ntoko kami menyediakan banyak hal, diantarnya :\n1. app premium\n2. jasa web\n3. jasa bot\n4. jasa jasa lain nya\n\nSilahkan register terlebih dahulu dengan memasukkan email anda :",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        528,
        2240
      ],
      "id": "48f83021-27b5-4748-baaf-cb8371e6a328",
      "name": "Send a text message8",
      "webhookId": "9524021e-8956-4ecb-8b41-6f2ed2d7de76",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": ".",
        "replyMarkup": "replyKeyboard",
        "replyKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "List product",
                    "additionalFields": {}
                  },
                  {
                    "text": "Stock",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "1",
                    "additionalFields": {}
                  },
                  {
                    "text": "2",
                    "additionalFields": {}
                  },
                  {
                    "text": "3",
                    "additionalFields": {}
                  },
                  {
                    "text": "4",
                    "additionalFields": {}
                  },
                  {
                    "text": "5",
                    "additionalFields": {}
                  },
                  {
                    "text": "6",
                    "additionalFields": {}
                  },
                  {
                    "text": "7",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "8",
                    "additionalFields": {}
                  },
                  {
                    "text": "9",
                    "additionalFields": {}
                  },
                  {
                    "text": "10",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Informasi",
                    "additionalFields": {}
                  },
                  {
                    "text": "Cara order",
                    "additionalFields": {}
                  },
                  {
                    "text": "Deposit",
                    "additionalFields": {}
                  }
                ]
              }
            }
          ]
        },
        "replyKeyboardOptions": {
          "resize_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        752,
        2240
      ],
      "id": "65883b9a-94c6-4d3a-bf43-3b7c2e0079b0",
      "name": "Send a text message4",
      "webhookId": "d7b9dca8-5fcf-4c1e-83e6-5dfe30ace08d",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Informasi Akun Kamu\n\ná¯“ Nama: {{ $('Select rows from a table').item.json.data[0].username }}\ná¯“ Saldo: Rp {{ $('Select rows from a table').item.json.data[0].balance }}\ná¯“ Nomer whatsapp: null\ná¯“ Terverifikasi: {{ $('Select rows from a table').item.json.data[0].status }}\ná¯“ User ID: {{ $('Select rows from a table').item.json.data[0].chat_id }}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3024,
        640
      ],
      "id": "91050c45-0f8e-47d5-8068-c038e3619697",
      "name": "Send a text message9",
      "webhookId": "9524021e-8956-4ecb-8b41-6f2ed2d7de76",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        528,
        2016
      ],
      "id": "c6c53f07-8158-4144-958c-b7b874e83c12",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3392,
        224
      ],
      "id": "fea6084d-9007-495c-bc3a-34d38e604539",
      "name": "Send a text message5",
      "webhookId": "120a958c-b921-4299-86be-0c35afa799d8",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Satu node saja untuk semua processing\nconst products = $input.all()\n\n// Generate tanggal\nconst now = new Date();\nconst formattedDate = now.toLocaleString('id-ID', {\n  timeZone: 'Asia/Jakarta',\n  day: '2-digit',\n  month: '2-digit',\n  year: 'numeric',\n  hour: '2-digit',\n  minute: '2-digit'\n});\n\n// Pastikan ada produk\nif (products.length === 0) {\n  const fallbackMessage = `ðŸ“¦ TIDAK ADA PRODUK\\nTanggal: ${formattedDate}`;\n  return [{ json: { message: fallbackMessage } }];\n}\n\n// Build message\nlet message = `ðŸ›ï¸ *DAFTAR PRODUK* \\nðŸ“… ${formattedDate}\\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\\n`;\n\nproducts.forEach((product, index) => {\n  const item = product.json;\n  const displayName = item.name ? item.name.toUpperCase() : 'PRODUK';\n  message += `*${index}.* ${displayName} - Stok: ${item.stock || 0}\\n`;\n});\n\nmessage += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\\nðŸ›’ Ketik angka (0-${products.length-1}) untuk beli:`;\n\nreturn [{ json: { message, products: products.map(p => p.json) } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        528,
        1792
      ],
      "id": "4d5b24bf-10c8-4d49-822c-527dd76044be",
      "name": "Code4"
    },
    {
      "parameters": {
        "jsCode": "// Ambil chatId dari Telegram Trigger\nconst chatId = $('Telegram Trigger1').first().json.message.chat.id;\n\n// Ambil hasil MySQL (semua row)\nconst rows = $input.all().map(item => item.json);\n\nlet message = \"â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\\n\";\nmessage += \"â”Š   LIST PRODUK\\n\";\nmessage += \"â”Š   Page 1/1\\n\";\nmessage += \"â”Šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\\n\";\n\n// Loop hasil query\nrows.forEach((row, index) => {\n  message += `â”Š [${index + 1}] ${row.name.toUpperCase()} (Stock: ${row.stock})\\n`;\n});\n\nmessage += \"â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\";\n\n// Return ke node berikutnya\nreturn [{\n  json: { chatId, message }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3168,
        224
      ],
      "id": "f49bd61e-96d8-43e0-ac01-14aa53b46412",
      "name": "Code3"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM products;\nSELECT * FROM accounts WHERE product_id = {{ $json.id }};\n",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        528,
        1568
      ],
      "id": "8f2380a1-8a0a-4540-ac04-674c90ad2417",
      "name": "Execute a SQL query",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "accounts",
          "mode": "list",
          "cachedResultName": "accounts"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2048,
        224
      ],
      "id": "67964a5e-a7c9-4107-95a0-c08094cbbc69",
      "name": "Select rows from a table3",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const rows = $input.all().length\nconst data = $input.all()\nreturn[{json:{rows, data}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2272,
        224
      ],
      "id": "d0921ba8-4dde-498e-979a-9e90050cf274",
      "name": "Code5"
    },
    {
      "parameters": {
        "operation": "upsert",
        "table": {
          "__rl": true,
          "value": "products",
          "mode": "list",
          "cachedResultName": "products"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "id",
        "valueToMatchOn": "={{ $('Code5').item.json.data[0].json.product_id }}",
        "valuesToSend": {
          "values": [
            {
              "column": "stock",
              "value": "={{ $('Code5').item.json.rows }}"
            },
            {
              "column": "name",
              "value": "={{ $json.name }}"
            },
            {
              "column": "price",
              "value": "={{ $json.price }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2720,
        224
      ],
      "id": "8bec8e87-001b-4282-8a70-ebd4dd64fa42",
      "name": "Insert or update rows in a table2",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "products",
          "mode": "list",
          "cachedResultName": "products"
        },
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $json.data[0].json.product_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2496,
        224
      ],
      "id": "1a1c739a-5b08-435c-897d-462f7f01b482",
      "name": "Select rows from a table4",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "products",
          "mode": "list",
          "cachedResultName": "products"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2944,
        224
      ],
      "id": "c693182d-74b0-458b-8894-94d37390a047",
      "name": "Select rows from a table5",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "products",
          "mode": "list",
          "cachedResultName": "products"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2320,
        -64
      ],
      "id": "b286d72f-1bcf-4804-b70a-fd889033c371",
      "name": "Select rows from a table6",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Ambil chatId dari Telegram Trigger\nconst chatId = $('Telegram Trigger1').first().json.message.chat.id;\n\n// Ambil hasil MySQL (semua row)\nconst rows = $input.all().map(item => item.json);\n\nlet message = \"â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\\n\";\nmessage += \"â”Š   LIST PRODUK\\n\";\nmessage += \"â”Š   Page 1/1\\n\";\nmessage += \"â”Šâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\\n\";\n\n// Loop hasil query\nrows.forEach((row, index) => {\n  message += `â”Š [${index + 1}] ${row.name.toUpperCase()} \\n`;\n});\n\nmessage += \"â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\";\n\n// Return ke node berikutnya\nreturn [{\n  json: { chatId, message }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2544,
        -64
      ],
      "id": "fe5289a6-8765-46a3-a015-3a52f981ef32",
      "name": "Code6"
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $('Code6').item.json.chatId }}",
        "binaryData": true,
        "replyMarkup": "replyKeyboard",
        "replyKeyboard": {
          "rows": [
            {}
          ]
        },
        "replyKeyboardOptions": {
          "resize_keyboard": true,
          "one_time_keyboard": false
        },
        "additionalFields": {
          "caption": "={{ $json.message }}"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2992,
        -64
      ],
      "id": "897ca71a-d17d-475c-af63-2e8cf57b7e72",
      "name": "Send a photo message1",
      "webhookId": "120a958c-b921-4299-86be-0c35afa799d8",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": ". /start",
        "replyMarkup": "replyKeyboard",
        "replyKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "List product",
                    "additionalFields": {}
                  },
                  {
                    "text": "Stock",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "1",
                    "additionalFields": {}
                  },
                  {
                    "text": "2",
                    "additionalFields": {}
                  },
                  {
                    "text": "3",
                    "additionalFields": {}
                  },
                  {
                    "text": "4",
                    "additionalFields": {}
                  },
                  {
                    "text": "5",
                    "additionalFields": {}
                  },
                  {
                    "text": "6",
                    "additionalFields": {}
                  },
                  {
                    "text": "7",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "8",
                    "additionalFields": {}
                  },
                  {
                    "text": "9",
                    "additionalFields": {}
                  },
                  {
                    "text": "10",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Informasi",
                    "additionalFields": {}
                  },
                  {
                    "text": "Cara order",
                    "additionalFields": {}
                  },
                  {
                    "text": "Deposit",
                    "additionalFields": {}
                  }
                ]
              }
            }
          ]
        },
        "replyKeyboardOptions": {
          "resize_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4272,
        352
      ],
      "id": "4c164306-a069-411b-8d64-93c489fe2995",
      "name": "Send a text message10",
      "webhookId": "d7b9dca8-5fcf-4c1e-83e6-5dfe30ace08d",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const chatId = $('Telegram Trigger1').first().json.message.chat.id\nreturn[{json:{chatId}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3616,
        352
      ],
      "id": "c96364d4-2e41-4787-b0b4-cf0ca984182d",
      "name": "Code7"
    },
    {
      "parameters": {
        "jsCode": "const teks = $('Telegram Trigger1').first().json.message.text\n\nif (teks === '1') {\n  return [{ json: { product: 'capcut' } }];\n}else if(teks === ''){\n  return [{json:{product: 'canva'}}]\n}else [{json:{product:'kosong'}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        480
      ],
      "id": "52d2ba11-d12e-425c-9d54-b49d407d2bb0",
      "name": "Code8"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "products",
          "mode": "list",
          "cachedResultName": "products"
        },
        "where": {
          "values": [
            {
              "column": "name",
              "value": "={{ $json.product }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        1664,
        480
      ],
      "id": "fb4a3289-4b84-42f8-85cd-4524ff13397d",
      "name": "Select rows from a table7",
      "credentials": {
        "mySql": {
          "id": "Y7CTksADXGxvRDva",
          "name": "anduqieq32j_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "={{ $json.description }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1856,
        576
      ],
      "id": "e97803b0-e273-4b35-9b5d-c0e96c2eedd0",
      "name": "Send a text message11",
      "webhookId": "9583f8f1-a1f1-4663-9cd0-0123c597b5bf",
      "credentials": {
        "telegramApi": {
          "id": "t9dexacOM09FzX6L",
          "name": "anduqieq32j_bot"
        }
      }
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-09-16T09:08:34.578Z",
      "createdAt": "2025-09-16T09:08:34.578Z",
      "role": "workflow:owner",
      "workflowId": "58EpDR0mTX5ea1LE",
      "projectId": "0nz33CIKfd8yNGpK"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-18T14:34:45.000Z",
  "versionId": "a672084a-ea96-433a-951c-a72cd7606f7e"
}